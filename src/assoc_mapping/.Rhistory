ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram() +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.01) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.01) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +geom_density() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ggplot(data=diplo_off, aes(x=prop_male)) + geom_histogram(binwidth=0.01) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +geom_density() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ngroups=3
ngroups=7
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ngroups=6
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ngroups=7
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+c","b", "b+c","a","a+b+c","c","a+b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
km_output
pie(x=km_output$cluster)
km_output$cluster
table(km_output$cluster)
group_size <- table(km_output$cluster)
pie(group_size)
ngroups=2
ngroups <- 2^scenario-1
scenario=2
ngroups <- 2^scenario-1
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
group_size <- table(km_output$cluster)
pie(group_size)
pie(group_size,labels = group_size)
ngroups=7
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
group_size <- table(km_output$cluster)
pie(group_size, labels=group_size)
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ngroups=7
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+c","b", "b+c","a","a+b+c","c","a+b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+c","b", "b+c","a","a+b+c","c","a+b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+c","b", "b+c","a","a+b+c","c","a+b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+c","b", "b+c","a","a+b+c","c","a+b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+c","b", "b+c","a","a+b+c","c","a+b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+c","b", "b+c","a","a+b+c","c","a+b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+c","b", "b+c","a","a+b+c","c","a+b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2) +guides(fill=F)
group_size <- table(km_output$cluster)
pie(group_size, labels=group_size)
contingency <- table('a','b','c','d')
contingency
cat_stat <- sum_stat %>%
group_by(Locus.ID, Chr, BP, cluster) %>%
summarise(Nf=sum(N.Females), Nm=sum(N.Males), N=sum(N.Samples),
Prop.Hom=sum(Prop.Hom*N.Samples, na.rm=T)/sum(N.Samples, na.rm=T),
Prop.Hom.F=sum(Prop.Hom.F*N.Females, na.rm=T)/sum(N.Females, na.rm=T),
Prop.Hom.M=sum(Prop.Hom.M*N.Males, na.rm=T)/sum(N.Males, na.rm=T))
get_fisher <- function(df){
# Computes fisher exact test on one row of the dataframe.
# alternative=greater -> test if males are more heterozygous than females
# alternative=less -> test if males are more homozygous than females
mat <- matrix(as.numeric(df[c("Fo","Mo","Fe","Me")]), ncol=2)
f <- fisher.test(as.table(mat), alt="less")
return(f$p.value)
}
odds_list <- cat_stat %>%
rename(Ft = Nf, Mt = Nm, Tt = N) %>%
mutate(Fo = Ft * Prop.Hom.F, Mo = Mt * Prop.Hom.M,
Fe = Ft * (1-Prop.Hom.F), Me = Mt * (1-Prop.Hom.M),
To = Tt * Prop.Hom, Te = Tt * (1-Prop.Hom)) %>%
select(-Prop.Hom, -Prop.Hom.F, -Prop.Hom.M) %>%
mutate_at(funs(round(.,0)), .vars = c("Fo","Fe","Mo","Me"))
for(group in unique(odds_list$cluster)){
odds_list$fisher[odds_list$cluster==group] <- p.adjust(odds_list$fisher[odds_list$cluster==group], method = "BH")
}
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
for(group in unique(odds_list$cluster)){
odds_list$fisher[odds_list$cluster==group] <- p.adjust(odds_list$fisher[odds_list$cluster==group], method = "BH")
}
nloci <- log2(max(groups$cluster)+1)
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(cluster~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
out <- "../../data/assoc_mapping/mother_groups.tsv"
write.table(diplo_off, out, sep='\t', row.names=F, quote=F)
groups <- read.table("../../data/assoc_mapping/mother_groups.tsv", header=T)
sum_stat <- sum_stat[sum_stat$N.Males>0 & sum_stat$N.Females>0,]
sum_stat <- sum_stat[!is.na(sum_stat$Prop.Hom),]
sum_stat$cluster <- groups$cluster[match(sum_stat$Family, groups$Family)]
sum_stat <- sum_stat[!is.na(sum_stat$cluster),]
cat_stat <- sum_stat %>%
group_by(Locus.ID, Chr, BP, cluster) %>%
summarise(Nf=sum(N.Females), Nm=sum(N.Males), N=sum(N.Samples),
Prop.Hom=sum(Prop.Hom*N.Samples, na.rm=T)/sum(N.Samples, na.rm=T),
Prop.Hom.F=sum(Prop.Hom.F*N.Females, na.rm=T)/sum(N.Females, na.rm=T),
Prop.Hom.M=sum(Prop.Hom.M*N.Males, na.rm=T)/sum(N.Males, na.rm=T))
get_fisher <- function(df){
# Computes fisher exact test on one row of the dataframe.
# alternative=greater -> test if males are more heterozygous than females
# alternative=less -> test if males are more homozygous than females
mat <- matrix(as.numeric(df[c("Fo","Mo","Fe","Me")]), ncol=2)
f <- fisher.test(as.table(mat), alt="less")
return(f$p.value)
}
odds_list <- cat_stat %>%
rename(Ft = Nf, Mt = Nm, Tt = N) %>%
mutate(Fo = Ft * Prop.Hom.F, Mo = Mt * Prop.Hom.M,
Fe = Ft * (1-Prop.Hom.F), Me = Mt * (1-Prop.Hom.M),
To = Tt * Prop.Hom, Te = Tt * (1-Prop.Hom)) %>%
select(-Prop.Hom, -Prop.Hom.F, -Prop.Hom.M) %>%
mutate_at(funs(round(.,0)), .vars = c("Fo","Fe","Mo","Me"))
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
for(group in unique(odds_list$cluster)){
odds_list$fisher[odds_list$cluster==group] <- p.adjust(odds_list$fisher[odds_list$cluster==group], method = "BH")
}
nloci <- log2(max(groups$cluster)+1)
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(cluster~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher)), col=cluster) + geom_point() + facet_grid(~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher), col=cluster)) + geom_point() + facet_grid(~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher), col=as.factor(cluster))) + geom_point() + facet_grid(~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
View(groups)
View(ploid)
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(cluster~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(cluster~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
scenario=2
ngroups <- 2^scenario-1
km_output <- kmeans(diplo_off$prop_male,centers = ngroups)
diplo_off$cluster <- km_output$cluster
pdf(paste0(dirname(out), "/plots/mother_groups.pdf"))
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
dev.off()
ggplot(data=diplo_off, aes(x=prop_male, fill=as.factor(cluster))) + geom_histogram(binwidth=0.02) +
ggtitle("Male proportion per family") + xlab("Proportion of males") + theme_bw() +
scale_fill_discrete(name="Heterozygous loci", labels=c("a+b","a", "b")) + ylab("Number of families") +
ylab("Number of families") + geom_vline(data=data.frame(km_output$centers),
aes(xintercept=km_output.centers), col='red', lty=2)
write.table(diplo_off, out, sep='\t', row.names=F, quote=F)
groups <- read.table("../../data/assoc_mapping/mother_groups.tsv", header=T)
sum_stat <- sum_stat[sum_stat$N.Males>0 & sum_stat$N.Females>0,]
sum_stat <- sum_stat[!is.na(sum_stat$Prop.Hom),]
sum_stat$cluster <- groups$cluster[match(sum_stat$Family, groups$Family)]
sum_stat <- sum_stat[!is.na(sum_stat$cluster),]
cat_stat <- sum_stat %>%
group_by(Locus.ID, Chr, BP, cluster) %>%
summarise(Nf=sum(N.Females), Nm=sum(N.Males), N=sum(N.Samples),
Prop.Hom=sum(Prop.Hom*N.Samples, na.rm=T)/sum(N.Samples, na.rm=T),
Prop.Hom.F=sum(Prop.Hom.F*N.Females, na.rm=T)/sum(N.Females, na.rm=T),
Prop.Hom.M=sum(Prop.Hom.M*N.Males, na.rm=T)/sum(N.Males, na.rm=T))
get_fisher <- function(df){
# Computes fisher exact test on one row of the dataframe.
# alternative=greater -> test if males are more heterozygous than females
# alternative=less -> test if males are more homozygous than females
mat <- matrix(as.numeric(df[c("Fo","Mo","Fe","Me")]), ncol=2)
f <- fisher.test(as.table(mat), alt="less")
return(f$p.value)
}
odds_list <- cat_stat %>%
rename(Ft = Nf, Mt = Nm, Tt = N) %>%
mutate(Fo = Ft * Prop.Hom.F, Mo = Mt * Prop.Hom.M,
Fe = Ft * (1-Prop.Hom.F), Me = Mt * (1-Prop.Hom.M),
To = Tt * Prop.Hom, Te = Tt * (1-Prop.Hom)) %>%
select(-Prop.Hom, -Prop.Hom.F, -Prop.Hom.M) %>%
mutate_at(funs(round(.,0)), .vars = c("Fo","Fe","Mo","Me"))
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
for(group in unique(odds_list$cluster)){
odds_list$fisher[odds_list$cluster==group] <- p.adjust(odds_list$fisher[odds_list$cluster==group], method = "BH")
}
nloci <- log2(max(groups$cluster)+1)
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(cluster~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
for(group in unique(odds_list$cluster)){
odds_list$fisher[odds_list$cluster==group] <- p.adjust(odds_list$fisher[odds_list$cluster==group], method = "bonferroni")
}
nloci <- log2(max(groups$cluster)+1)
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(cluster~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
odds_list <- cat_stat %>%
rename(Ft = Nf, Mt = Nm, Tt = N) %>%
mutate(Fo = Ft * Prop.Hom.F, Mo = Mt * Prop.Hom.M,
Fe = Ft * (1-Prop.Hom.F), Me = Mt * (1-Prop.Hom.M),
To = Tt * Prop.Hom, Te = Tt * (1-Prop.Hom)) %>%
select(-Prop.Hom, -Prop.Hom.F, -Prop.Hom.M) %>%
mutate_at(funs(round(.,0)), .vars = c("Fo","Fe","Mo","Me"))
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
nloci <- log2(max(groups$cluster)+1)
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(cluster~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
cat_stat <- sum_stat %>%
group_by(Locus.ID, Chr, BP) %>%
summarise(Nf=sum(N.Females), Nm=sum(N.Males), N=sum(N.Samples),
Prop.Hom=sum(Prop.Hom*N.Samples, na.rm=T)/sum(N.Samples, na.rm=T),
Prop.Hom.F=sum(Prop.Hom.F*N.Females, na.rm=T)/sum(N.Females, na.rm=T),
Prop.Hom.M=sum(Prop.Hom.M*N.Males, na.rm=T)/sum(N.Males, na.rm=T))
get_fisher <- function(df){
# Computes fisher exact test on one row of the dataframe.
# alternative=greater -> test if males are more heterozygous than females
# alternative=less -> test if males are more homozygous than females
mat <- matrix(as.numeric(df[c("Fo","Mo","Fe","Me")]), ncol=2)
f <- fisher.test(as.table(mat), alt="less")
return(f$p.value)
}
odds_list <- cat_stat %>%
rename(Ft = Nf, Mt = Nm, Tt = N) %>%
mutate(Fo = Ft * Prop.Hom.F, Mo = Mt * Prop.Hom.M,
Fe = Ft * (1-Prop.Hom.F), Me = Mt * (1-Prop.Hom.M),
To = Tt * Prop.Hom, Te = Tt * (1-Prop.Hom)) %>%
select(-Prop.Hom, -Prop.Hom.F, -Prop.Hom.M) %>%
mutate_at(funs(round(.,0)), .vars = c("Fo","Fe","Mo","Me"))
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
odds_list$fisher <- p.adjust(odds_list$fisher, method = "BH")
nloci <- log2(max(groups$cluster)+1)
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(cluster~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
odds_list$fisher <- p.adjust(odds_list$fisher, method = "bonferroni")
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
View(tot_off)
get_fisher <- function(df){
# Computes fisher exact test on one row of the dataframe.
# alternative=greater -> test if males are more heterozygous than females
# alternative=less -> test if males are more homozygous than females
mat <- matrix(as.numeric(df[c("Fo","Mo","Fe","Me")]), ncol=2)
f <- fisher.test(as.table(mat), alt="less")
return(f$p.value)
}
odds_list <- cat_stat %>%
rename(Ft = Nf, Mt = Nm, Tt = N) %>%
mutate(Fo = Ft * Prop.Hom.F, Mo = Mt * Prop.Hom.M,
Fe = Ft * (1-Prop.Hom.F), Me = Mt * (1-Prop.Hom.M),
To = Tt * Prop.Hom, Te = Tt * (1-Prop.Hom)) %>%
select(-Prop.Hom, -Prop.Hom.F, -Prop.Hom.M) %>%
mutate_at(funs(round(.,0)), .vars = c("Fo","Fe","Mo","Me"))
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
maptab <- rbind(c(tot,single,multi,miss),
c(170435458,94668507,44531856,31235095))
library("kable")
install.packages("kable")
install.packages("Kable")
maptab <- rbind(c("tot","single","multi","miss"),
c(170435458,94668507,44531856,31235095))
knitr::kable(maptab)
Csval <- c(12585, 56971)
Cstab <- rbind(c("N loci","mean coverage","SD coverage"),
c(Csval[1],Csval[2]))
knitr::kable(Cstab)
poptbl <- read.table("../../../data/ploidy/thresholds/fixed.tsv", header=T)
poptbl
poptbl
odds_chrom <- odds_list
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(cluster~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
View(odds_chrom)
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher), col=Chr)) + geom_point()  +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher), col=Chr)) + geom_point()  +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") +
ylim(c(0,10)) + guides(col=F)
View(odds_chrom)
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
odds_cont <- odds_list[!grep("chr.*",odds_list$Chr),]
ggplot(data=odds_cont, aes(x=BP, y=-log10(fisher))) + geom_point() +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
odds_cont
View(odds_list)
odds_cont <- odds_list[grep("tig.*",odds_list$Chr),]
ggplot(data=odds_cont, aes(x=BP, y=-log10(fisher))) + geom_point() +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
ggplot(data=odds_cont, aes(x=BP, y=-log10(fisher))) + geom_point() +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") +
ylim(c(0,10)) + facet_grid(~Chr, scales='free_x')
unique(odds_cont$Chr)
length(unique(odds_cont$Chr))
length(unique(odds_cont$Chr[odds_cont$fisher<0.01]))
length(unique(odds_cont$Chr[odds_cont$fisher<0.001]))
length(unique(odds_cont$Chr[odds_cont$fisher<0.01]))
odds_cont <- odds_cont[odds_cont$Chr %in% tigs,]
tigs <- unique(odds_cont$Chr[odds_cont$fisher<0.01])  # Contigs with significant hits
odds_cont <- odds_cont[odds_cont$Chr %in% tigs,]
ggplot(data=odds_cont, aes(x=BP, y=-log10(fisher))) + geom_point() +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") +
ylim(c(0,10)) + facet_grid(~Chr, scales='free_x')
ggplot(data=odds_cont, aes(x=BP, y=-log10(fisher))) + geom_point() +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") +
ylim(c(0,10)) + facet_wrap(~Chr, scales='free_x')
ggplot(data=odds_cont, aes(x=BP, y=-log10(fisher))) + geom_point() +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD: Unordered contigs") +
ylim(c(0,10)) + facet_wrap(~Chr, scales='free_x')
cat_stat <- sum_stat %>%
group_by(Locus.ID, Chr, BP) %>%
summarise(Nf=sum(N.Females), Nm=sum(N.Males), N=sum(N.Samples),
Prop.Hom=sum(Prop.Hom*N.Samples, na.rm=T)/sum(N.Samples, na.rm=T),
Prop.Hom.F=sum(Prop.Hom.F*N.Females, na.rm=T)/sum(N.Females, na.rm=T),
Prop.Hom.M=sum(Prop.Hom.M*N.Males, na.rm=T)/sum(N.Males, na.rm=T))
get_fisher <- function(df){
# Computes fisher exact test on one row of the dataframe.
# alternative=greater -> test if males are more heterozygous than females
# alternative=less -> test if males are more homozygous than females
mat <- matrix(as.numeric(df[c("Fo","Mo","Fe","Me")]), ncol=2)
f <- fisher.test(as.table(mat), alt="less")
return(f$p.value)
}
odds_list <- cat_stat %>%
rename(Ft = Nf, Mt = Nm, Tt = N) %>%
mutate(Fo = Ft * Prop.Hom.F, Mo = Mt * Prop.Hom.M,
Fe = Ft * (1-Prop.Hom.F), Me = Mt * (1-Prop.Hom.M),
To = Tt * Prop.Hom, Te = Tt * (1-Prop.Hom)) %>%
select(-Prop.Hom, -Prop.Hom.F, -Prop.Hom.M) %>%
mutate_at(funs(round(.,0)), .vars = c("Fo","Fe","Mo","Me"))
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
odds_list$fisher <- p.adjust(odds_list$fisher, method = "BH")
odds_chrom <- odds_list[grep("chr.*",odds_list$Chr),]
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(cluster~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
ggplot(data=odds_chrom, aes(x=BP, y=-log10(fisher))) + geom_point() + facet_grid(~Chr, scales='free_x') +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD") + ylim(c(0,10))
odds_cont <- odds_list[grep("tig.*",odds_list$Chr),]
tigs <- unique(odds_cont$Chr[odds_cont$fisher<0.01])  # Contigs with significant hits
odds_cont <- odds_cont[odds_cont$Chr %in% tigs,]
ggplot(data=odds_cont, aes(x=BP, y=-log10(fisher))) + geom_point() +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD: Unordered contigs") +
ylim(c(0,10)) + facet_wrap(~Chr, scales='free_x')
odds_list$fisher <- apply(odds_list, 1,  get_fisher)
odds_list$fisher <- p.adjust(odds_list$fisher, method = "bonferroni")
odds_cont <- odds_list[grep("tig.*",odds_list$Chr),]
tigs <- unique(odds_cont$Chr[odds_cont$fisher<0.01])  # Contigs with significant hits
odds_cont <- odds_cont[odds_cont$Chr %in% tigs,]
ggplot(data=odds_cont, aes(x=BP, y=-log10(fisher))) + geom_point() +
geom_hline(aes(yintercept=-log10(0.05))) + geom_hline(aes(yintercept=-log10(0.01)), lty=2, col='red') +
xlab("Genomic position") + ylab("-log10 p-value") + ggtitle("Case-control association test for CSD: Unordered contigs") +
ylim(c(0,10)) + facet_wrap(~Chr, scales='free_x')
