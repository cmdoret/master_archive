centrolist[['slideMean']] <- data.frame(pos = rep(0,6), Chr=levels(fix$Chr), val=rep(0,6))
store_means <- data.frame(BP=numeric(0),Chr=numeric(0),S.Mean=numeric(0))
for(chrom in levels(fix$Chr)){
plot(x=c(),y=c(),xlim=c(0,max(fix$BP[fix$Chr==chrom])), ylim=c(-0.05,1),
xlab=chrom,ylab="Homozygosity")
abline(h=-0.01)
for(w in wsize_range){
HOM = zoo(fix$Prop.Hom[fix$Chr==chrom],order.by = fix$BP[fix$Chr==chrom])
sliMean = rollapply(HOM, width=w, by=1, FUN=mean, partial=F)
bp_idx = index(sliMean)
points(bp_idx[order(bp_idx)],sliMean[order(bp_idx)], type='l',col=alpha(virilist[colindex],0.4),lwd=1.3)
points(bp_idx[which(sliMean==min(sliMean, na.rm=T))],rep(-0.01,length(which(sliMean==min(sliMean, na.rm=T)))),
col=alpha(virilist[colindex],0.4),pch=16, cex=1.5)
centrolist$slideMean$pos[centrolist$slideMean$Chr==chrom] <- bp_idx[which(sliMean==min(sliMean, na.rm=T))]
centrolist$slideMean$val[centrolist$slideMean$Chr==chrom] <- sliMean[sliMean==min(sliMean, na.rm=T)]
colindex <- colindex+1
}
colindex <- 1
tmp_df <- data.frame(BP=bp_idx, Chr=rep(chrom), S.Mean=sliMean)
store_means <- rbind(store_means,tmp_df)
}
#==== COMPUTE LOCAL REGRESSIONS ====#
# Allows to try all different values of span in a range.
virilist <- viridis(n=length(sp_range))
colindex <- 1
#par(mfrow=c(1,6))
centrolist[['loess']] <- data.frame(pos = rep(0,6), Chr=levels(fix$Chr), val=rep(0,6))
for(chrom in levels(fix$Chr)){
plot(x=c(),y=c(),xlim=c(0,max(fix$BP[fix$Chr==chrom])), ylim=c(-0.05,1),
xlab=chrom,ylab="Homozygosity")
abline(h=-0.01)
for(sp in sp_range){
mod <- loess(data=fix[fix$Chr==chrom,], degree=2,
formula=Prop.Hom~BP, weights=N.Samples, span=sp, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',col=alpha(virilist[colindex],0.4),lwd=1.3)
points(mod$x[mod$fitted==min(mod$fitted)],rep(-0.01,length(mod$x[mod$fitted==min(mod$fitted)])),
col=alpha(virilist[colindex],0.4),pch=16, cex=1.5)
centrolist$loess$pos[centrolist$loess$Chr==chrom] <- mod$x[mod$fitted==min(mod$fitted)]
centrolist$loess$val[centrolist$loess$Chr==chrom] <- min(mod$fitted)
colindex <- colindex+1
}
colindex <- 1
}
View(fix0)
if(length(sp_range)==1 & length(wsize_range)==1){
zoomfactor <- 1000000  # For aesthetics
loessPlot <- ggplot(fix, aes(x=BP/zoomfactor, y=Prop.Hom, weight=N.Samples)) + facet_grid(~Chr, scales = 'free_x') +
geom_point(col='grey70') + geom_smooth(aes(col='Local regression'),
method='loess', span=sp_range) +
xlab("Genomic position (Mb)") + ylab("Homozygosity") +
geom_segment(data=centrolist$loess, aes(x=pos/zoomfactor,xend=pos/zoomfactor, y=0, yend=val, col='Local regression'),
lty=2, lwd=1.1, inherit.aes = F) + theme_bw() +
geom_line(data=store_means, aes(x=BP/zoomfactor, y=S.Mean, col='Moving average'), lwd=1.1, inherit.aes = F) +
geom_segment(data=centrolist$slideMean, aes(x=pos/zoomfactor,xend=pos/zoomfactor, y=0, yend=val, col='Moving average'),
lty=2, lwd=0.9, inherit.aes = F) +
scale_color_brewer(palette="Set1") + scale_fill_brewer(palette="Set1") +
guides(color=guide_legend(title="Method")) +
geom_point(data=centrolist$slideMean, aes(x=pos/zoomfactor, y=0, col='Moving average'), inherit.aes = F, size=2) +
geom_point(data=centrolist$loess, aes(x=pos/zoomfactor, y=0, col='Local regression'), inherit.aes = F, size=2)
loessPlot
}
loessPlot <- ggplot(fix, aes(x=BP/zoomfactor, y=Prop.Hom, weight=N.Samples)) + facet_grid(~Chr, scales = 'free_x') +
geom_point(col='grey70') + geom_smooth(aes(col='Local regression'),
method='loess', span=sp_range) +
xlab("Genomic position (Mb)") + ylab("Homozygosity") +
geom_segment(data=centrolist$loess, aes(x=pos/zoomfactor,xend=pos/zoomfactor, y=0, yend=val, col='Local regression'),
lty=2, lwd=1.1, inherit.aes = F) + theme_bw() +
geom_line(data=store_means, aes(x=BP/zoomfactor, y=S.Mean, col='Moving average'), lwd=1.1, inherit.aes = F) +
geom_segment(data=centrolist$slideMean, aes(x=pos/zoomfactor,xend=pos/zoomfactor, y=0, yend=val, col='Moving average'),
lty=2, lwd=0.9, inherit.aes = F) +
scale_color_brewer(palette="Set1") + scale_fill_brewer(palette="Set1") +
guides(color=guide_legend(title="Method")) +
geom_point(data=centrolist$slideMean, aes(x=pos/zoomfactor, y=0, col='Moving average'), inherit.aes = F, size=2) +
geom_point(data=centrolist$loess, aes(x=pos/zoomfactor, y=0, col='Local regression'), inherit.aes = F, size=2)
loessPlot
zoomfactor <- 1000000  # For aesthetics
loessPlot <- ggplot(fix, aes(x=BP/zoomfactor, y=Prop.Hom, weight=N.Samples)) + facet_grid(~Chr, scales = 'free_x') +
geom_point(col='grey70') + geom_smooth(aes(col='Local regression'),
method='loess', span=sp_range) +
xlab("Genomic position (Mb)") + ylab("Homozygosity") +
geom_segment(data=centrolist$loess, aes(x=pos/zoomfactor,xend=pos/zoomfactor, y=0, yend=val, col='Local regression'),
lty=2, lwd=1.1, inherit.aes = F) + theme_bw() +
geom_line(data=store_means, aes(x=BP/zoomfactor, y=S.Mean, col='Moving average'), lwd=1.1, inherit.aes = F) +
geom_segment(data=centrolist$slideMean, aes(x=pos/zoomfactor,xend=pos/zoomfactor, y=0, yend=val, col='Moving average'),
lty=2, lwd=0.9, inherit.aes = F) +
scale_color_brewer(palette="Set1") + scale_fill_brewer(palette="Set1") +
guides(color=guide_legend(title="Method")) +
geom_point(data=centrolist$slideMean, aes(x=pos/zoomfactor, y=0, col='Moving average'), inherit.aes = F, size=2) +
geom_point(data=centrolist$loess, aes(x=pos/zoomfactor, y=0, col='Local regression'), inherit.aes = F, size=2)
loessPlot
wsize_range <- 20  # Size of the moving average window
sp_range <- 0.75  # Pro
# This script is used to differentiate between telocentric and metacentric
# chromosomes and locate each centromere. This is done by using the density
# of heterozygous sites in the mother that become homozygous in offspring
# along the chromosome.
# 30.07.2017
# Cyril Matthey-Doret
#==== SELECT PARAMETERS ====#
wsize_range <- 20  # Size of the moving average window
sp_range <- 0.75  # Proportion of SNPs to be included in each local regression
# wsize_range <- seq(5, 40, 1)
# sp_range <- seq(0.15, 1, 0.01)
#==== LOAD PACKAGES AND DATA ====#
pack <- c("ggplot2","dplyr","viridis","zoo", "readr")
lapply(pack, require, character.only = TRUE)
indv <- read.table('../../data/individuals', header=T)
grouped <- "F"
fix0 <- read.table("../../data/assoc_mapping/grouped_outpool_prop_hom_fixed_sites.tsv",
header=T, na.strings='NA', sep='\t')
fix <- fix0[fix0$N.Samples>0,]
fix <- fix[grep("chr.*",fix$Chr),]
#test <- select(fix,-Family)
#fix <- test %>%
#  group_by(Chr, BP) %>%
#  summarise(N.Samples=sum(N.Samples, na.rm=T), Prop.Hom=mean(Prop.Hom, na.rm=T))
fix$Chr <- factor(fix$Chr)
fix$Chr <- droplevels(fix$Chr)
fix <- fix[!is.na(fix$Prop.Hom),]
#==== COMPUTE SLIDING MEANS ====#
# Allows to try different values of window size in a range
# Note that the step size is fixed to 1 but can be changed
# directly in the code if neded.
virilist <- viridis(n=length(wsize_range))
colindex <- 1
par(mfrow=c(2,6))
centrolist <- list()
centrolist[['slideMean']] <- data.frame(pos = rep(0,6), Chr=levels(fix$Chr), val=rep(0,6))
store_means <- data.frame(BP=numeric(0),Chr=numeric(0),S.Mean=numeric(0))
for(chrom in levels(fix$Chr)){
plot(x=c(),y=c(),xlim=c(0,max(fix$BP[fix$Chr==chrom])), ylim=c(-0.05,1),
xlab=chrom,ylab="Homozygosity")
abline(h=-0.01)
for(w in wsize_range){
HOM = zoo(fix$Prop.Hom[fix$Chr==chrom],order.by = fix$BP[fix$Chr==chrom])
sliMean = rollapply(HOM, width=w, by=1, FUN=mean, partial=F)
bp_idx = index(sliMean)
points(bp_idx[order(bp_idx)],sliMean[order(bp_idx)], type='l',col=alpha(virilist[colindex],0.4),lwd=1.3)
points(bp_idx[which(sliMean==min(sliMean, na.rm=T))],rep(-0.01,length(which(sliMean==min(sliMean, na.rm=T)))),
col=alpha(virilist[colindex],0.4),pch=16, cex=1.5)
centrolist$slideMean$pos[centrolist$slideMean$Chr==chrom] <- bp_idx[which(sliMean==min(sliMean, na.rm=T))]
centrolist$slideMean$val[centrolist$slideMean$Chr==chrom] <- sliMean[sliMean==min(sliMean, na.rm=T)]
colindex <- colindex+1
}
colindex <- 1
tmp_df <- data.frame(BP=bp_idx, Chr=rep(chrom), S.Mean=sliMean)
store_means <- rbind(store_means,tmp_df)
}
#==== COMPUTE LOCAL REGRESSIONS ====#
# Allows to try all different values of span in a range.
virilist <- viridis(n=length(sp_range))
colindex <- 1
#par(mfrow=c(1,6))
centrolist[['loess']] <- data.frame(pos = rep(0,6), Chr=levels(fix$Chr), val=rep(0,6))
for(chrom in levels(fix$Chr)){
plot(x=c(),y=c(),xlim=c(0,max(fix$BP[fix$Chr==chrom])), ylim=c(-0.05,1),
xlab=chrom,ylab="Homozygosity")
abline(h=-0.01)
for(sp in sp_range){
mod <- loess(data=fix[fix$Chr==chrom,], degree=2,
formula=Prop.Hom~BP, weights=N.Samples, span=sp, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',col=alpha(virilist[colindex],0.4),lwd=1.3)
points(mod$x[mod$fitted==min(mod$fitted)],rep(-0.01,length(mod$x[mod$fitted==min(mod$fitted)])),
col=alpha(virilist[colindex],0.4),pch=16, cex=1.5)
centrolist$loess$pos[centrolist$loess$Chr==chrom] <- mod$x[mod$fitted==min(mod$fitted)]
centrolist$loess$val[centrolist$loess$Chr==chrom] <- min(mod$fitted)
colindex <- colindex+1
}
colindex <- 1
}
#==== VISUALIZE ====#
# Will only run if the user chose one single value for each parameter.
if(length(sp_range)==1 & length(wsize_range)==1){
zoomfactor <- 1000000  # For aesthetics
loessPlot <- ggplot(fix, aes(x=BP/zoomfactor, y=Prop.Hom, weight=N.Samples)) + facet_grid(~Chr, scales = 'free_x') +
geom_point(col='grey70') + geom_smooth(aes(col='Local regression'),
method='loess', span=sp_range) +
xlab("Genomic position (Mb)") + ylab("Homozygosity") +
geom_segment(data=centrolist$loess, aes(x=pos/zoomfactor,xend=pos/zoomfactor, y=0, yend=val, col='Local regression'),
lty=2, lwd=1.1, inherit.aes = F) + theme_bw() +
geom_line(data=store_means, aes(x=BP/zoomfactor, y=S.Mean, col='Moving average'), lwd=1.1, inherit.aes = F) +
geom_segment(data=centrolist$slideMean, aes(x=pos/zoomfactor,xend=pos/zoomfactor, y=0, yend=val, col='Moving average'),
lty=2, lwd=0.9, inherit.aes = F) +
scale_color_brewer(palette="Set1") + scale_fill_brewer(palette="Set1") +
guides(color=guide_legend(title="Method")) +
geom_point(data=centrolist$slideMean, aes(x=pos/zoomfactor, y=0, col='Moving average'), inherit.aes = F, size=2) +
geom_point(data=centrolist$loess, aes(x=pos/zoomfactor, y=0, col='Local regression'), inherit.aes = F, size=2)
loessPlot
}
centrolist$loess
centrolist$loess
library(dplyr)
library(ggplot2)
hom_path <- "../../data/assoc_mapping/grouped_prop_hom_fixed_sites.tsv"
indv <- read.table('../../data/individuals', header=T)
scaffolds <- read.table("../../data/ref_genome/ordered_genome/merged.fasta.ann", stringsAsFactors = F)
grouped <- "T"
chrom_sizes <- data.frame(); chrom_names=c()
for(row in seq(1,nrow(scaffolds))){
if(length(grep('chr',scaffolds[row,2]))){
chrom_names <- append(chrom_names,as.character(scaffolds[row,2]))
chrom_sizes <- rbind(chrom_sizes, scaffolds[row+1,c(1,2)])
}
}
chrom_sizes <- cbind(chrom_names, chrom_sizes)
rownames(chrom_sizes) <- NULL
colnames(chrom_sizes) <- c("chrom","start","length")
chrom_sizes$length <- as.numeric(chrom_sizes$length)
chrom_sizes$mid <- chrom_sizes$start + (chrom_sizes$length/2)  # Middle position in chrom. used for plotting
sum_stat <- read.table(hom_path, header=T, na.strings='NA', sep='\t')
sum_stat <- read.table(hom_path, header=T, na.strings='NA', sep='\t')
sum_stat <- sum_stat[sum_stat$N.Samples>0,]
sum_stat <- sum_stat[!is.na(sum_stat$Prop.Hom),]
CSD_like <- sum_stat %>% mutate(CSD=((1-Prop.Hom.F)+Prop.Hom.M)/2)
CSD_like <- CSD_like %>% arrange(Chr, BP)
chrom <- CSD_like[grep("chr.*", CSD_like$Chr),]
chrom$pos <- paste(chrom$Chr,chrom$BP, sep="_")
chrom$Chr <- as.factor(chrom$Chr)
chrom$Chr <- droplevels(chrom$Chr)
genomic_pos <- function(snp){
# Computing total basepair position in genome as start(chrom)+bp
gen_pos <- as.numeric(snp["BP"]) + chrom_sizes[chrom_sizes$chr==snp["Chr"],"start"]
return(gen_pos)
}
chrom$tot_BP <-apply(X = chrom,MARGIN = 1, FUN=genomic_pos)
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) + geom_point() +facet_grid(~Chr, scales = "free_x")
compact_chrom <- chrom %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), BP=mean(tot_BP)) %>%
arrange(BP)
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
abline(v=chrom_sizes$start, lty=2,col="blue")
text(x = chrom_sizes$mid,y=0.2,labels = chrom_sizes$chrom)
highCSD <- chrom %>%
group_by(fam) %>%
filter(CSD==max(CSD))
top_CSD <- chrom[chrom$CSD>=0.85 & chrom$Family!="J",]
hist(top_CSD$tot_BP,breaks=100, main="Top CSD candidates", xlab="Genomic position", ylab="N hits >= 0.8", col="grey")
abline(v=chrom_sizes$start, lty=2,col="blue")
text(x = chrom_sizes$mid,y=17,labels = chrom_sizes$chrom)
ggplot(data=chrom, aes(x=tot_BP, y=CSD))+ geom_line() +
facet_wrap(~Family,drop = F) + #geom_text(data=highCSD,aes(label=pos, y=CSD), size=1.9)+
geom_vline(data=chrom_sizes, aes(xintercept=start), col="blue", lty=2) +
ylab("Prop.CSD")
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) + geom_point() +facet_grid(~Chr, scales = "free_x")
ggplot(data=chrom[chrom$Family!='J'],aes(x=BP,y=CSD, col=Family)) + geom_point() +facet_grid(~Chr, scales = "free_x")
ggplot(data=chrom[chrom$Family!='J',],aes(x=BP,y=CSD, col=Family)) + geom_point() +facet_grid(~Chr, scales = "free_x")
compact_chrom <- chrom %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), BP=mean(tot_BP)) %>%
arrange(BP)
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
ggplot(data=compact_chrom, aes(x=BP, y=avg)) + stat_smooth()
compact_chrom <- chrom[chrom$Family!='J',] %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), BP=mean(tot_BP)) %>%
arrange(BP)
ggplot(data=compact_chrom, aes(x=BP, y=avg)) + stat_smooth()
ggplot(data=compact_chrom, aes(x=BP, y=avg)) + stat_smooth() + geom_vline(aes(xintercept=chrom_sizzes$start))
ggplot(data=compact_chrom, aes(x=BP, y=avg)) + stat_smooth() + geom_vline(aes(xintercept=chrom_sizes$start))
ggplot(data=compact_chrom, aes(x=BP, y=avg)) + stat_smooth() + geom_vline(aes(xintercept=chrom_sizes$start), inherit.aes=F)
ggplot(data=compact_chrom, aes(x=BP, y=avg)) + stat_smooth() + geom_vline(aes(xintercept=chrom_sizes$start, inherit.aes=F))
ggplot(data=compact_chrom, aes(x=BP, y=avg)) + stat_smooth() + geom_vline(data=chrom_sizes aes(xintercept=chrom_sizes$start, inherit.aes=F))
ggplot(data=compact_chrom, aes(x=BP, y=avg)) + stat_smooth() + geom_vline(data=chrom_sizes, aes(xintercept=chrom_sizes$start, inherit.aes=F))
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) + geom_point() +facet_grid(~Chr, scales = "free_x") + stat_smooth()
warnings()
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") + stat_smooth(se = F)
ggplot(data=chrom,aes(x=BP,y=log10(CSD), col=Family)) +facet_grid(~Chr, scales = "free_x") + stat_smooth(se = F)
ggplot(data=chrom[chrom$Family!='E'],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") + stat_smooth(se = F)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") + stat_smooth(se = F)
centro <- read.table("../../data/assoc_mapping/centrolist.tsv")
centro
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(se = F) + geom_vline(data=centro, aes(xintercept=pos))
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(se = F) + geom_vline(data=centro, aes(xintercept=pos), inherit.aes=F)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(se = F) + geom_vline(data=centro, aes(xintercept=pos, inherit.aes=F))
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(se = F) + geom_vline(data=centro, aes(xintercept=centro$pos))
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(se = F) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
centro
centro <- read.table("../../data/assoc_mapping/centrolist.tsv", header=T)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(se = F) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
lty=2
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(se = F) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
geom_point() + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=N.Males)) +facet_grid(~Chr, scales = "free_x") +
geom_point() + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=N.Males-N.Females)) +facet_grid(~Chr, scales = "free_x") +
geom_point() + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=(Prop.Hom.F*N.Females+Prop.Hom.M.*N.Males), col=N.Males-N.Females)) +facet_grid(~Chr, scales = "free_x") +
geom_point() + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=(Prop.Hom.F*N.Females+Prop.Hom.M*N.Males), col=N.Males-N.Females)) +facet_grid(~Chr, scales = "free_x") +
geom_point() + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
compact_chrom <- chrom[chrom$Family!='J',] %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), BP=mean(tot_BP)) %>%
arrange(BP)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=(Prop.Hom.F*N.Females+Prop.Hom.M*N.Males), col=Family)) +facet_grid(~Chr, scales = "free_x") +
geom_point() + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=(Prop.Hom.F*N.Females+Prop.Hom.M*N.Males)/N.Samples, col=Family)) +facet_grid(~Chr, scales = "free_x") +
geom_point() + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$Family!='E',],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
geom_point() + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
View(chrom)
chrom <- chrom[chrom$N.Females>0 & chrom$N.Males>0]
chrom <- chrom[chrom$N.Females>0 & chrom$N.Males>0,]
genomic_pos <- function(snp){
# Computing total basepair position in genome as start(chrom)+bp
gen_pos <- as.numeric(snp["BP"]) + chrom_sizes[chrom_sizes$chr==snp["Chr"],"start"]
return(gen_pos)
}
chrom$tot_BP <-apply(X = chrom,MARGIN = 1, FUN=genomic_pos)
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
geom_point() + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth() + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.15) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.25) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=25) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=5) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.7) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
warnings()
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.05) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.45) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
View(chrom)
compact_chrom <- chrom %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), BP=mean(tot_BP)) %>%
arrange(BP)
loess(data=compact_chrom, formula=avg~BP)
compact_chrom <- chrom %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), indv=nrow(.), BP=mean(tot_BP)) %>%
arrange(BP)
View(compact_chrom)
compact_chrom <- chrom %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), indv=nrow(tot_bp), BP=mean(tot_BP)) %>%
arrange(BP)
compact_chrom <- chrom %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), indv=nrow(tot_bp), BP=mean(tot_BP)) %>%
arrange(BP)
compact_chrom <- chrom %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), indv=length(tot_BP), BP=mean(tot_BP)) %>%
arrange(BP)
compact_chrom
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod < -loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.25, degree = 2, model=T)
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.25, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',col=alpha(virilist[colindex],0.4),lwd=1.3)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3)
abline(v=chrom_sizes$start, lty=2,col="blue")
text(x = chrom_sizes$mid,y=0.2,labels = chrom_sizes$chrom)
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.05, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3)
abline(v=chrom_sizes$start, lty=2,col="blue")
text(x = chrom_sizes$mid,y=0.2,labels = chrom_sizes$chrom)
plot(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3)
abline(v=chrom_sizes$start, lty=2,col="blue")
text(x = chrom_sizes$mid,y=0.2,labels = chrom_sizes$chrom)
plot(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.05, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
abline(v=chrom_sizes$start, lty=2,col="blue")
text(x = chrom_sizes$mid,y=0.2,labels = chrom_sizes$chrom)
compact_chrom <- chrom[chrom$Family!='J',] %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), indv=length(tot_BP), BP=mean(tot_BP)) %>%
arrange(BP)
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.05, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
abline(v=chrom_sizes$start, lty=2,col="blue")
text(x = chrom_sizes$mid,y=0.2,labels = chrom_sizes$chrom)
plot(compact_chrom$BP, sin(compact_chrom$avg), type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.05, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
plot(compact_chrom$BP, cos(compact_chrom$avg), type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.05, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
plot(compact_chrom$BP, tan(compact_chrom$avg), type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.05, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
plot(compact_chrom$BP, log(compact_chrom$avg), type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.05, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
abline(v=chrom_sizes$start, lty=2,col="blue")
plot(compact_chrom$BP, sqrt(compact_chrom$avg), type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.05, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.05, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
abline(v=chrom_sizes$start, lty=2,col="blue")
compact_chrom <- compact_chrom[compact_chrom$indv>5,]
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.05, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
abline(v=chrom_sizes$start, lty=2,col="blue")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.15, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.15, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
abline(v=chrom_sizes$start, lty=2,col="blue")
text(x = chrom_sizes$mid,y=0.2,labels = chrom_sizes$chrom)
abline(h=0.8)
View(compact_chrom)
View(chrom)
compact_chrom <- chrom[chrom$Family!='J',] %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), indv=length(N.samples), BP=mean(tot_BP)) %>%
arrange(BP)
compact_chrom <- chrom[chrom$Family!='J',] %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), indv=length(N.Samples), BP=mean(tot_BP)) %>%
arrange(BP)
cc < compact_chrom[compact_chrom$indv>5,]
cc <- compact_chrom[compact_chrom$indv>5,]
compact_chrom <- chrom[chrom$Family!='J',] %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), indv=length(unique(Family)), BP=mean(tot_BP)) %>%
arrange(BP)
cc <- compact_chrom[compact_chrom$indv>5,]
compact_chrom <- compact_chrom[compact_chrom$indv>5,]
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.15, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
abline(v=chrom_sizes$start, lty=2,col="blue")
compact_chrom <- chrom[chrom$Family!='J',] %>%
group_by(Locus.ID) %>%
summarise(avg=mean(CSD), indv=length(unique(Family)), BP=mean(tot_BP)) %>%
arrange(BP)
compact_chrom <- compact_chrom[compact_chrom$indv>3,]
plot(compact_chrom$BP, compact_chrom$avg, type="l", ylab='prop. CSD', xlab="genomic position",
main="Proportion of CSD individuals, averaged across families")
mod <- loess(data=compact_chrom, formula=avg~BP, weights = indv, span = 0.15, degree = 2, model=T)
points(mod$x[order(mod$x)],mod$fitted[order(mod$x)], type='l',lwd=1.3, col='red')
abline(v=chrom_sizes$start, lty=2,col="blue")
ggplot(data=chrom,aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.45) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$N.Females>2 & chrom$N.Males>2,],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.45) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$N.Females>2 & chrom$N.Males>2,],aes(x=BP,y=CSD, col=Family)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.75) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$N.Females>2 & chrom$N.Males>2,],aes(x=BP,y=CSD, col=Family, weights=N.Sample)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.75) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$N.Females>2 & chrom$N.Males>2,],aes(x=BP,y=CSD, col=Family, weights=N.Samples)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.75) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
ggplot(data=chrom[chrom$N.Females>2 & chrom$N.Males>2,],aes(x=BP,y=CSD, col=Family, weight=N.Samples)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.75) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
highCSD <- chrom %>%
group_by(fam) %>%
filter(CSD==max(CSD))
highCSD <- chrom %>%
group_by(Family) %>%
filter(CSD==max(CSD))
View(highCSD)
plot(highCSD$tot_BP, highCSD$Prop.Hom)
plot(highCSD$tot_BP, highCSD$Prop.Hom, col=Family)
plot(highCSD$tot_BP, highCSD$Prop.Hom, col=highCSD$Family)
plot(highCSD$tot_BP, highCSD$N.Samples, col=highCSD$Family)
abline(v=chrom_sizes$start, lty=2,col="blue")
plot(highCSD$tot_BP, highCSD$CSD, col=highCSD$Family)
top_CSD <- chrom[chrom$CSD>=thresh,]
thresh=0.85
top_CSD <- chrom[chrom$CSD>=thresh,]
hist(top_CSD$tot_BP,breaks=100, main="Top CSD candidates", xlab="Genomic position", ylab="N hits >= 0.8", col="grey")
abline(v=chrom_sizes$start, lty=2,col="blue")
text(x = chrom_sizes$mid,y=17,labels = chrom_sizes$chrom)
hist(top_CSD$tot_BP,breaks=100, main="Top CSD candidates", xlab="Genomic position", ylab=paste0("N hits >= ", thresh), col="grey")
ggplot(data=chrom[chrom$N.Females>2 & chrom$N.Males>2,],aes(x=BP,y=CSD, col=Family, weight=N.Samples)) +facet_grid(~Chr, scales = "free_x") +
stat_smooth(span=0.75) + geom_vline(data=centro, aes(xintercept=pos), col='blue', lty=2)
uniq_CSD = top_CSD[order(top_CSD[,'tot_BP'],-top_CSD[,'CSD']),]
out_CSD <- uniq_CSD[,c("Locus.ID","Chr","BP", "Family","tot_BP","Nf","Nm","CSD")]
out_CSD <- top_CSD[,c("Locus.ID","Chr","BP", "Family","tot_BP","Nf","Nm","CSD")]
out_CSD <- top_CSD
View(out_CSD)
